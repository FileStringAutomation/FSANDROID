*** Settings ***
Resource          BusinessKeywordsForAndroid.txt
Library           DatabaseLibrary
Library           robotmail
Library           Selenium2Library

*** Variables ***

*** Keywords ***
fsand_Sign Up Full
    [Arguments]    ${v_firstName}    ${v_lastName}    ${v_emailAddress}    ${v_password}    ${v_titleAlert}    ${v_messageAlert}
    #    fs_loadDataFromFileNewVersion    ${CURDIR}/Data.xlsx
    Comment    fsand_Click Back    #    Close What's New
    fsand_Verify Sign In Screen
    #    Change environment
    fsand_Change Environment    Staging
    #    Click Sign Up Now to move to Sign Up form
    fsand_Click Navigate Sign In To Sign Up Screen
    #    Input First Name
    fsand_Input First Name    ${v_firstName}
    #    Input Last Name
    fsand_Input Last Name    ${v_lastName}
    #    input email address
    fsand_Input Email Address_Sign Up    ${v_emailAddress}
    #    input password
    fsand_Input Password_Sign Up    ${v_password}
    #    Click Sign Up Button
    fsand_Click Sign Up Button
    #    Verify Title "Verify Email after Sign UP"
    fsand_Verify Title Alert    ${v_titleAlert}
    #    Verify Mesage "Verify Email after Sign UP "
    fsand_Verify Message Alert    ${v_messageAlert}
    #    Click OK button
    fsand_Click Positive Button

fsand_Sign Up Just Fill All Value
    [Arguments]    ${v_firstName}    ${v_lastName}    ${v_emailAddress}    ${v_password}
    #    fs_loadDataFromFileNewVersion    ${CURDIR}/Data.xlsx
    fsand_Click Back    #    Close What's New
    fsand_Verify Sign In Screen
    #    Change environment
    fsand_Change Environment    Staging
    #    Click Sign Up Now to move to Sign Up form
    fsand_Click Navigate Sign In To Sign Up Screen
    #    Input First Name
    fsand_Input First Name    ${v_firstName}
    #    Input Last Name
    fsand_Input Last Name    ${v_lastName}
    #    input email address
    fsand_Input Email Address_Sign Up    ${v_emailAddress}
    #    input password
    fsand_Input Password_Sign Up    ${v_password}

fsand_Input Email Address_Sign Up
    [Arguments]    ${v_EmailAdress}
    AppiumLibrary.Input Text    ${SignUp_EmailAddress}    ${v_EmailAdress}

fsand_Input Password_Sign Up
    [Arguments]    ${v_Password}
    AppiumLibrary.Input Password    ${SignUp_CreatePassword}    ${v_Password}

fsand_Input First Name
    [Arguments]    ${v_FirstName}
    AppiumLibrary.Input Text    ${SignUp_Fistname}    ${v_FirstName}

fsand_Input Last Name
    [Arguments]    ${v_LastName}
    AppiumLibrary.Input Text    ${SignUp_Lastname}    ${v_LastName}

fsand_Click Sign Up Button
    AppiumLibrary.Click Element    ${SignUp_CreateButton}

fsand_Sign Up Button Disable
    Element Should Be Disabled    ${SignUp_CreateButton}

fsand_Verify Title Alert
    [Arguments]    ${v_titleAlert}
    AppiumLibrary.Wait Until Page Contains    ${v_titleAlert}    50s

fsand_Verify Message Alert
    [Arguments]    ${v_messageAlert}
    AppiumLibrary.Wait Until Page Contains    ${v_messageAlert}    50s

fsand_Delete User Information In Database
    [Arguments]    ${v_emailAddress}
    #    Connect to database
    ${v_isConnectedToDatabase}=    Run Keyword And Ignore Error    DatabaseLibrary.Connect To Database Using Custom Params    adodbapi    'Provider=SQLOLEDB.1;Data Source=${v_databaseSource};Initial Catalog=${v_databaseName};User Id=${v_databaseUsername};Password=${v_databaseUserPassword};'
    Run Keyword If    '${v_isConnectedToDatabase[0]}'=='FAIL'    Fail    Could not connect to database, the error was: "${v_isConnectedToDatabase[1]}"
    #    Get current account ID based on its email address
    ${v_userID}=    DatabaseLibrary.Query    select UserID from [User] where Username='${v_emailAddress.strip()}'
    ${v_userID}=    Replace String    ${v_userID[0][0]}    {    ${EMPTY}
    ${v_userID}=    Replace String    ${v_userID}    }    ${EMPTY}
    #    Delete User In database
    Run Keyword And Ignore Error    DatabaseLibrary.Execute Sql String    DELETE FROM NotificationDeviceToken WHERE DeviceOwnerId = '${v_userID}' ; DELETE FROM wizarduser WHERE userid = '${v_userID}' ; DELETE FROM [user] WHERE username = '${v_emailAddress.strip()}'
    #    Verify Account must not exist in database
    ${v_isAccountExistInDatabase}=    Run Keyword And Ignore Error    DatabaseLibrary.Check If Exists In Database    select UserID from [User] where Username='${v_emailAddress.strip()}'
    Run Keyword If    '${v_isAccountExistInDatabase[0]}'=='PASS'    Fail    Your account: "${v_emailaddress}" still exist in database after delete!!!

fsand_verify Email When Register An Account
    [Arguments]    ${v_firstname}    ${v_emailAddress}    ${v_password}
    robotmail.Open Mailbox    imap.gmail.com    ${v_emailAddress}    ${v_password}    ${True}
    ${v_emailID}=    robotmail.Wait For Mail
    #    Email body
    Comment    ${v_emailBody}=    ImapLibrary.Get Email Body    ${v_emailID}
    #    Email content
    Comment    ${v_result}=    ImapLibrary.Get Matches From Email    ${v_emailID}    [\\w\\W]*[\\s\\n]*Hi ${v_firstname},[\\n\\s]*To complete your FileString sign up process, we need you to verify your email address. This ensures that someone else isn't trying to use your address. The address entered to create this account is${v_emailAddress}.[\\s\\n]*Click the button below to verify your email address and create your FileString account:[\\s\\n]*Verify Your Email Address[\\n\\s]*If you did not sign up for this FileString account, ignore this email and the account under this email address will not be created.[\\s\\n]*Thank you.[\\s\\n]*The FileString Team - "String It"[\\w\\W]*
    ${v_allLinks}=    robotmail.Get All Links From Email    ${v_emailID}
    robotmail.Close Mailbox
    Comment    ${v_length}=    Get Length    ${v_result}
    Comment    Run Keyword If    ${v_length}!=1    Fail    Email content does not match with email's format
    Set Test Variable    ${v_allLinks}

fsand_goto Link on Email to Verify Email Address
    [Arguments]    ${v_verifyLink}
    fsweb_Open Optional Browser And Set Selenium Speed    ${v_verifyLink}    gc    30s
    #    Verify page contain "Email Address is verified"
    ${v_result}=    Run Keyword And Ignore Error    Selenium2Library.Wait Until Page Contains    Congratulations!
    Close All Browsers
    Run Keyword If    '${v_result[0]}'=='FAIL'    Fail    The link to verify email address is incorrect! Or Email address is not verified. Error message was: "${v_result[1]}"

fsweb_Open Optional Browser And Set Selenium Speed
    [Arguments]    ${v_baseUrl}    ${v_browser}    ${v_seleniumSpeed}
    Open Browser    ${v_baseUrl}    ${v_browser}
    Maximize Browser Window
    Set Selenium Timeout    ${v_seleniumSpeed}

fsand_Mark All Emails As Read After Sign Up
    [Arguments]    ${v_emailAddress}    ${v_password}
    robotmail.Open Mailbox    imap.gmail.com    ${v_emailAddress}    ${v_password}    ${True}
    Comment    robotmail.Mark Email As Read
    robotmail.Delete All Emails
    robotmail.Close Mailbox

fsand_Sign Up Successful

fsand_Template_Cannot Sign Up
